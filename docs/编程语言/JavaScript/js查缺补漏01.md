---
title: js查缺补漏01
tags: js知识补充
categories: js
keywords: js,基础
description: 你不知道的js
abbrlink: 393b2a4c
date: 2019-08-11 21:55:55
---

### JS 变量的存放

基本类型：保存在**栈**内存中，因为这些类型在内存中分别占有固定大小的空间，通过按值来访问

引用类型：保存在**堆**内存中，因为这些值的大小是不固定的，但是内存地址值的大小是固定的，所以在**栈**保存内存地址，所以通过先访问栈中的内存地址，再通过地址找到堆中的值

```js
var a = { name: "aaa" };
var b = a;
a = null;
console.log(b); // { name: 'aaa' }，因为只是把a的引用地址设为了null，并没有影响堆内存的对象，所以b的引用地址还是可以访问到堆内存里的内容
```

```js
var a = { n: 1 };
var b = a;
a.x = a = { n: 2 };

a.x; // --> undefined，由于.的优先级大于=，所以先执行a.x=a,此时a就是{n: 1,x:undefined}，然后执行a={n: 2}，所以a就被赋值为{n: 2}
b.x; // --> {n: 2}，a={n: 2}是指向了另一个地址，和b没有关系，但是a.x和b.x指向了同一个地址，a.x发生变化，b.x也发生变化，被赋值为{ n: 2 }
```

### **垃圾回收机制**

标记清除：将所有未被标记的内存当作垃圾，全部进行回收

### **造成内存泄露的情况**

- 全局变量
- 未被清除的计时器（setInterval）或回调函数
- 脱离 DOM 的引用
- 闭包

### **Set、Map 和 WeakSet、WeakMap 的区别**

**弱引用**：即如果没有别处引用该键值的内容，那么该内存就会被垃圾回收机制回收

- Set
  - 成员唯一、无序且不重复
  - 可以遍历
- WeakSet
  - 成员都是对象
  - 成员都是**弱引用**，可以被垃圾回收机制回收，可以用来保存 DOM 节点，不容易造成内存泄漏
  - 不能遍历
- Map
  - 键值对的集合
  - 可以遍历
- WeakMap
  - 只接受对象作为键名（null 除外），不接受其他类型的值作为键名
  - 键名是**弱引用**，键值可以是任意的，键名所指向的对象可以被垃圾回收，此时键名是无效的
  - 不能遍历

### **[3, 15, 8, 29, 102, 22].sort()返回的是啥**

- [102, 15, 22, 29, 3, 8]，默认的排序方法会将数组元素**转换为字符串**，然后比较字符串中字符的 UTF-16 编码顺序来进行排序
- 正确姿势： [3, 15, 8, 29, 102, 22].sort((a,b) => {return a - b});

### **以下代码会输出什么？**

```js
var obj = {
  "2": 3,
  "3": 4,
  length: 2,
  splice: Array.prototype.splice,
  push: Array.prototype.push
};
obj.push(1);
obj.push(2);
console.log(obj);
// {
//   "2": 1,
//   "3": 2,
//   length: 2,
//   splice: Array.prototype.splice,
//   push: Array.prototype.push
// }
```

**push 会根据数组的 length 来添加新项**，所以它访问到了 obj.length 为 2，所以就将 obj[2]=1,并且设置 obj.length 加 1 为 3，所以第二次将 obj[3]=2

### **数组里面有 10 万个数据，取第一个元素和第 10 万个元素的时间相差多少**

一样，js 的数组实际上也是对象，其索引会被转化为字符串，作为属性名来获取值，查找又是使用**哈希**表，所以第一个和第 10 万个查找速度是一样的

### **以下代码会输出什么？**

```js
var name = "Tom";
(function() {
  if (typeof name == "undefined") {
    var name = "Jack";
    console.log("Goodbye " + name);
  } else {
    console.log("Hello " + name);
  }
})();
```

Goodbye Jack,因为 if 没有作用域，所以 var 变量声明提升，在第一个判断时，name 为 undefined


### **JS 异步解决方案的发展历程以及优缺点**
--------异步