## 概述

Rollup.js 是一个 JavaScript 的打包器，可以将模块代码通过 Common.js、Require.js、ES Modules 等规范组合到一起，其以轻巧，低配置的优势被使用到很多的纯 js 库中，当然如果是搭建一些应用，涉及各种资源，还是推荐使用 webpack 进行打包

> rollup 自带 Tree-shaking，会将没有用到的代码进行过滤

## 使用

```js
npm install -g rollup
```

### 指令

```md
rollup main.js --file bundle.js --format umd --name "myBundle"
```

### 配置文件

在项目的根目录下（rollup 默认查找位置）创建一个 rollup.config.js，或者执行指令的时候注明配置文件的路径

```md
rollup --config ./config/rollup.config.dev.js
```

以下就是一个最简单的配置（**也是必须填的项**），将 main.js 打包到 bundle.js 文件下

```js
// package.json
{
  // ...
  "scripts": {
    "build": "rollup -c"
  }
  // ...
}
```

```js
// rollup.config.js
export default {
  input: 'src/main.js',
  output: {
    file: 'bundle.js',
    format: 'iife',
  },
};
```

:::tip
format 即是导出文件的类型（模块规范）设置，可设置为

- amd AMD 模块机制
- cjs CommonJS 模块机制
- esm ES Modules 模块机制
- iife 浏览器环境使用
- umd 以 amd, cjs, 和 iife 为一体
- system - SystemJS 加载器格式
  :::

### 一次打包多种类型

如果写多个 output 那么就会打包多个

```js
{
  // ...
  output: [
    {
      name: 'index.js',
      file: 'es/index.js',
      format: 'es',
    },
    {
      name: 'index.js',
      file: 'umd/index.js',
      format: 'umd',
    },
    {
      name: 'index.js',
      file: 'cjs/index.js',
      format: 'cjs',
    },
  ];
}
```

### Plugins

除了打包的入口，出口，rollup 还支持插件进行提供额外的功能,直接添加在 plugins 的数组里即可

```js
const json = require('rollup-plugin-json');
export default {
  input: 'src/main.js',
  output: {
    file: 'bundle.js',
    format: 'iife',
  },
  plugins: [json()],
};
```

### 常用的插件

#### 让 rollup 能够读取 json 文件

rollup-plugin-json

#### 告诉 rollup 如何查找外部模块

rollup-plugin-node-resolve

#### 让 rollup 支持 Common.js

rollup-plugin-commonjs

#### 转换 JS 代码

rollup-plugin-babel

#### 支持 ts

rollup-plugin-typescript2

### external

被外链标识的内容将不会被打包

```js
export default {
  ...,
  external: [
    'library',
    path.resolve( './src/bundled.js' )
  ]
};
```

### sourcemap

是否生成 sourcemap 文件
