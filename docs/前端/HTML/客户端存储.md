## 区别

- sessionStorage 和 localStorage 均为一个对象（一个持久化关联数组），索引（键名）和值（键值）都由字符串形式显示

- 两者不同之处在于对数据的有效期（存储多久）和作用域（不同的网站是否共享数据）

- cookie 除了名和值，还有一些可选的属性来控制 cookie 的有效期和作用域，cookie 会在客户端每次请求时发送给服务器，一旦 cookie 过多会导致报头过大，造成浪费。

### 存储大小

- sessionStorage 和 localStorage 可以存储 5MB 的数据，而 cookie 不得超过 4KB

### 有效期

- sessionStorage 在浏览器关闭或者相应数据保存的网页（标签页）关闭，该网页的 sessionStorage 内容将被清空，而 localStorage 则一直保留，除非代码设置清空或用户通过设置浏览器配置删除。

- cookie 的有效期是当整个浏览器关闭，随之消失。可以通过 Expires 和 Max-Age 属性设置 cookie 的过期时间，如果设置了，浏览器会将 cookie 内容写入磁盘中并保存，使其不会在浏览器关闭就删除。

  <a data-fancybox title="cookie 有效期" href="/前端/cookie 有效期.png "cookie 有效期"">![cookie有效期](/前端/cookie有效期.png 'cookie有效期')</a>

### 作用域

- localStorage 的作用域是限定在文档源级别（文档源是通过协议，主机名以及端口号确定的，任意一项不相同，即是不同源的），同源的共享同样的 localStorage 数据，可相互读取甚至覆盖。（不同浏览器不可共享，如谷歌浏览器不可访问 IE 浏览器的数据）

- sessionStorage 的作用域也是限定在文档源级别，同时其还被限制于自己窗口下，即两个同源的标签页是不能共享数据的。如果一个窗口下有两个 iframe 元素，且包含的文档是同源的，那么这两者是可以共享数据的。

- cookie 也是通过文档源和文档路径来确定的，默认情况下，创建 cookie 的 web 页中的 cookie 数据可以与该页面的同目录或者子目录共享。（作用域可以通过 path 和 domain 属性配置）

## storage 方法

可以通过以下方式对其设值或添加值

```js
window.sessionStorage.setItem('name', 'zjf');
window.sessionStorage['name'] = 'zjf';
window.sessionStorage.name = 'zjf';
```

可以通过以下方式获取索引字符串对应的值

```js
let name = window.sessionStorage.getItem('name');
let name = window.sessionStorage['name'];
let name = window.sessionStorage.name;
```

可以通过以下方式删除索引字符串对应的值

```js
window.sessionStorage.removeItem('name');
delete window.sessionStorage.name; //低版本浏览器不一定支持
// 删除所有保存的数据
window.sessionStorage.clear();
// 通过 length 和 key()方法枚举所有存储的数据
for (var i = 0; i < window.sessionStorage.length; i++) {
  var name = window.sessionStorage.key(i);
  var value = window.sessionStorage.getItem(name);
  console.log(name + ':' + value);
}
```

字段中的 cookie

- cookie 的处理过程：

1. 服务器向客户端发送 cookie
2. 浏览器将 cookie 保存
3. 之后每次浏览器在请求都会将 cookie 发现服务器端

- 客户端发送的请求报文的 cookie 字段

```md
"Cookie: foo=bar; baz=val" "http://127.0.0.1:3000/path?foo=bar&foo=baz"
```

- 响应报文的 Set-Cookie 字段

```md
"Set-Cookie: name=value;Path=/;Expires=Sun,23-Apr-23 09:01:35 GMT;Domain=.domain.com"
```

- NAME=VALUE：赋予 Cookie 的名称和其值（必填项）
- expires=DATE：Cookie 的有效期（若不明确指定则默认为浏览器关闭前为止）
- path=PATH：将服务器上的文件目录作为 Cookie 的适用对象（若不指明则认为文档所在的文件目录）
- domain=域名：作为 Cookie 适用对象的域名（若不指定则默认为创建 Cookie 的服务器的域名）
- 还有三个对 Cookie 进行出于安全目的的限制

- Secure：仅在 HTTPS 安全通信时才会发送 Cookie
- HttpOnly：加以限制，使 Cookie 不能被 JavaScript 脚本访问
  cookie 的方法
- SameSite：只允许同站请求，禁止跨站请求，可以用于阻止 CSRF（跨站请求伪造攻击）
  - None： 不作为，跨站同站都可以发送
  - Strict：只能在相同站点是发送 cookie
  - Lax：默认值，为跨站子请求做保留，如图片，iframe 等加载

## cookie

```js
function setcookie(name, value, daysToLive) {
//存储前需 encodeURIComponent()对值进行编码，读取时需要 decodeURIComponent()解码
var cookie = name + "=" + encodeURIComponent(value);
if(typeof daysToLive === "number") {
cookie += "; max-age=" + (daysToLive _ 60 _ 60 \* 24);
cookie += "; path=" + (地址);
//各种属性可按以上格式添加
}
document.cookie = cookie;
}
```

## 读取 cookie

```js
function getcookie() {
  var cookie = {};
  var all = document.cookie;
  if (all === '') return cookie;
  var list = all.split(';'); //分离出名、值对
  for (var i = 0; i < list.length; i++) {
    var cookie = list[i];
    var p = cookie.indexOf('='); //找到第一个‘=’的索引
    var name = cookie.substring(0, p); //获取‘=’前的名
    var value = cookie.substring(p + 1); //获取‘=’后的值
    value = decodeURIComponent(value);
    cookie[name] = value;
  }
  return cookie;
}
```
