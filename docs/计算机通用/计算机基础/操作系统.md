## 概述

操作系统是连接硬件和应用软件的系统软件，是用以控制和管理系统资源，方便用户使用计算机程序的集合——<em>资源管理者</em>。

## 程序、进程、线程

- 程序 = 数据结构 + 算法
- 程序是静态的，是某个功能指令的有序集合。进程就是“动态的程序”，是<em>程序的执行</em>
- 进程 = 程序 + 数据 + <em>进程控制块</em>（PCB，用于记录进程信息）
- 程序和进程可以是<em>多对多</em>，即一个进程可以对应多个程序，一个程序也可以对应多个进程

- 进程是线程的容器，所以一个进程可以有多个线程，但是一个线程只能属于一个进程
- 线程是操作系统<em>最基本（最小）的调度单元</em>，当一个进程被创建的时候，同时也会创建一个线程，否则改进程无法被调用执行
- 进程是资源分配的基本单元，所以每个进程都有独立的资源，而线程不拥有资源（有自己独立的 stack 栈，但是共享 heap 堆），同一个进程下的线程共享当前进程的资源
- 在多核 CPU 计算机中，多进程和多线程都可以实现并行

- 系统调用会分配给进程时间片，而一个进程内的线程又会“拆分”这个时间片
- 线程如果发起系统调用造成阻塞就会使整个进程进入等待状态，即该进程下的所有线程也进入等待状态

### 多进程和多线程

| 比较项     | 进程                   | 线程                   |
| ---------- | ---------------------- | ---------------------- |
| 数据传输   | 需要通过 IPC，数据独立 | 数据进程共享           |
| CPU 利用率 | 低                     | 高                     |
| 销毁切换   | 开销大，速度慢         | 开销小，速度快         |
| 可靠性     | 相互不影响             | ”同住屋檐下“，相互影响 |

### 进程状态切换

<a data-fancybox title="进程状态切换" href="/计算机通用/进程状态切换.png">![进程状态切换](/计算机通用/进程状态切换.png)</a>

- 就绪状态通过调度转为运行状态
- 运行状态在时间片用完后转为就绪状态
- 当没有可使用的资源，运行状态就会转成阻塞（等待）状态，当然有了资源，就会进入运行状态

### 进程通信

- 管道
  - 匿名管道： 只能是父子进程通信
  - 命名管道： 没有关系的限制，即都可以通信
- 信号量
  - 一般作为锁机制
- 消息队列
  - 由第三方作为中间件来传输消息
- 信号
- 共享内存
  - 创建一个都能访问的进程
- 套接字

:::tip
在 node 中，进程通信就是通过管道到方式

- windows:命名管道
- \*nix:Unix Domain socket，由 socket 实现的一种 IPC 方式，也是全双工
  :::
