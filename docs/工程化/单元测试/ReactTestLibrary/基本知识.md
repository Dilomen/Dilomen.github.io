## 概述

React Testing Library 是 React 官方推荐的一款测试工具库（Jest+ReactTestLibaray），方便配合 Jest 等测试框架更好的进行 React 相关单元测试。该框架出发点和 Enzyme 完全不同，其不提倡直接修改组件内部状态。而是调试通过组件 render 生成的真实 DOM，即站在使用的角度来进行测试。

:::tip
testing-library 提供了很多不同框架的测试工具库
[官方文档地址](https://testing-library.com/docs/)
:::

## 安装

```bash
npm install --save-dev @testing-library/react
yarn add -D @testing-library/react
```

## API

首先从导出内容可以看到，除了 render 和 cleanup 是该库导出的，以及 act 是封装一层，其余都是@testing-library/dom 中导出的，那么本章就看该库导出的 3 个 API，其余请在@testing-library/dom 篇章查看

```js
// @testing-library/react/types/index.d.ts
export * from '@testing-library/dom'
// ...
export function render(
  ui: React.ReactElement,
  options?: Omit<RenderOptions, 'queries'>,
): RenderResult
export function render<Q extends Queries>(
  ui: React.ReactElement,
  options: RenderOptions<Q>,
): RenderResult<Q>

export function cleanup(): Promise<void>

export const act: typeof reactAct extends undefined
  ? (callback: () => void) => void
  : typeof reactAct

```

### render

```js
function render(
  ui: React.ReactElement<any>,
  options?: {
    /* You won't often use this, expand below for docs on options */
  }
): RenderResult
```

该 API 会将组件生成可操作的 DOM 对象和查询 API

```js
export type RenderResult<
  Q extends Queries = typeof queries,
  Container extends Element | DocumentFragment = HTMLElement
>
```

<a data-fancybox title="render" href="/前端/react-test-libaray_render_component.png"><img width="300px" src="/前端/react-test-libaray_render_component.png" /></a>

:::tip
借助了 react-dom 的相关渲染方法

```js
function render() {
  // ...
  act(function() {
    if (hydrate) {
      ReactDOM.hydrate(wrapUiIfNeeded(ui), container);
    } else {
      ReactDOM.render(wrapUiIfNeeded(ui), container);
    }
  });
}
```

:::

```js
function Greeting() {
  return <div>Hello, world!</div>;
}
test("Test render", () => {
  const { container } = render(<Greeting />);
  // 可以直接使用container来进行DOM测试
  expect(container.firstChild.nodeName).toBe("DIV");
});
```

也可以提供的查询 API 来找到对应的元素进行 DOM 测试，查询 API 可见[官网](https://testing-library.com/docs/react-testing-library/cheatsheet)，当然你也可以自定义查询方法。

```js
test("Test render", () => {
  const { container, getByText } = render(<Greeting />);
  expect(getByText("Hello, world!").nodeName).toBe("DIV");
});
```

#### options

options 配置，作为一个不是必需的参数，其主要有以下配置

| 配置项      | 作用                                          | 参数            |
| ----------- | --------------------------------------------- | --------------- |
| container   | 指定渲染后加入的父元素，默认 document.body    | HTMLElement     |
| baseElement | 就是 container 的默认元素，默认 document.body | HTMLElement     |
| hydrate     | 是否使用 ReactDOM.hydrate 渲染方式            | boolean         |
| wrapper     | 高阶组件，包裹渲染的内容                      | React Component |
| queries     | 支持的查询 API                                | Object          |

#### return

return 出来的就是你可以来测试内容

| 配置项      | 作用                                                  | 返回值      |
| ----------- | ----------------------------------------------------- | ----------- |
| queries     | 支持的查询 API                                        | Object      |
| container   | 指定渲染后加入的父元素，默认 document.body            | HTMLElement |
| baseElement | 就是 container 的默认元素，默认 document.body         | HTMLElement |
| debug       | 打印出整个渲染后的 DOM 结构                           |             | Function |
| rerender    | 更新渲染的组件，通常对同一个组件不同的 props 进行使用 | Function    |
| unmount     | 卸载当前渲染的组件，同时 container 等内容也会被清空   | Function    |
| asFragment  | 对当前组件渲染结构                                    | Function    |

## cleanup

清除当前的渲染树，防止内存泄漏，一般可以在每次 test 结束中设置

```js
afterEach(() => {
  cleanup();
});
```

## act

这是对 react-dom/test-utils 方法库的一层封装
