(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{495:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"执行机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行机制"}},[t._v("#")]),t._v(" 执行机制")]),t._v(" "),a("p",[t._v("1、执行 new Vue({})，"),a("em",[t._v("初始化")]),t._v("，初始化生命周期，绑定 props,data,methods,computed,watch 等属性，还有注册相关全局方法（如emit，destory 等）")]),t._v(" "),a("p",[t._v("2、然后根据实例化是否有 render 函数，有就直接进入下一步，没有就看有没有 template，然后"),a("em",[t._v("模板编译转成 render 函数")])]),t._v(" "),a("p",[t._v("3、然后 render 函数执行生成 VNode，这个过程中会读取相应的数据，也就是会将动态数据通过 Object.defineProperty 进行 getter 和 setter 的设置，来实现"),a("em",[t._v("响应式和依赖收集")])]),t._v(" "),a("p",[t._v("4、render 生成 VNode 树，通过_update 进行调用 patch 来将"),a("em",[t._v("VNode 转化为真实 DOM")]),t._v("，首次渲染")]),t._v(" "),a("p",[t._v("5、之后的数据变化 set 会通知依赖进行调用 Watcher 实例（当前依赖）的 run 方法重新获取（get）新的数据，并调用 Watcher 实例（当前依赖）绑定的 "),a("em",[t._v("updateComponent 方法")]),t._v("再次"),a("em",[t._v("调用_render")]),t._v(" 生成新的 VNode，以及"),a("em",[t._v("调用_update，进行 patch比较")]),t._v(" 来生成新的 DOM 渲染")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("补充")]),t._v(" "),a("p",[t._v("我们写的每一个 vue 文件，其实都是一个 component 组件，那么每一个组件都有生命周期。所以说是不是每一个组件都会调用 new Vue({})呢?")]),t._v(" "),a("p",[t._v("答案：是的"),a("br"),t._v("\n当 patch 在处理 VNode 的时候，遇到组件 VNode，会调用 createComponent 方法，组件的构造器都是继承 Vue 的，所以相当于是生成了一个 Vue 实例，以及执行了挂载操作。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("componentOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Ctor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nchild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hydrating "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("具体详情可以参考 Virtaul DOM 篇章")])]),t._v(" "),a("h2",{attrs:{id:"运行版和完整版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行版和完整版"}},[t._v("#")]),t._v(" 运行版和完整版")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"vue打包文件",href:"/源码/vue打包文件.png"}},[a("img",{attrs:{src:"/%E6%BA%90%E7%A0%81/vue%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6.png",alt:"vue打包文件"}})])]),t._v(" "),a("h4",{attrs:{id:"首先我们可以看到-vue-源码打包出来的主要分为两种-一种是不带-runtime-一种是带-runtime-的-那么为什么需要两个版本呢-这两个版本有什么区别呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#首先我们可以看到-vue-源码打包出来的主要分为两种-一种是不带-runtime-一种是带-runtime-的-那么为什么需要两个版本呢-这两个版本有什么区别呢"}},[t._v("#")]),t._v(" 首先我们可以看到 vue 源码打包出来的主要分为两种，一种是不带 runtime，一种是带 runtime 的，那么为什么需要两个版本呢？这两个版本有什么区别呢")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"vue打包入口文件",href:"/源码/vue打包入口文件.png"}},[a("img",{attrs:{src:"/%E6%BA%90%E7%A0%81/vue%E6%89%93%E5%8C%85%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6.png",alt:"vue打包入口文件"}})])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以es模块机制为例")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web-full-esm'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web/entry-runtime-with-compiler.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/vue.esm.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" he"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./entity-decoder'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  banner\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web-runtime-esm'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web/entry-runtime.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/vue.runtime.esm.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  banner\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("由上面的打包入口文件，可以看出，两者最大的区别就是是否带有编译器的代码，即将模板转成 render 函数的功能")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("编译器的作用就是将源代码转成目标代码")])]),t._v(" "),a("h4",{attrs:{id:"为什么这个功能可以省去呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么这个功能可以省去呢"}},[t._v("#")]),t._v(" 为什么这个功能可以省去呢")]),t._v(" "),a("p",[t._v("首先 vue 模板是不会被浏览器识别的，所以转成 render 函数这个操作是必须的！！！但是将这个操作放在哪里执行是可以选择的！！！")]),t._v(" "),a("p",[t._v("如果将这个功能通过 vue-loader 这样的工具实现，直接生成 render 函数给浏览器，那么就不需要加载完整版的 vue 文件，即减小浏览器引入 vue 文件的体积大小，从而提升性能")]),t._v(" "),a("p",[t._v("使用运行版开发的两种方式")]),t._v(" "),a("ul",[a("li",[t._v("直接写 render 函数")]),t._v(" "),a("li",[t._v("借助 vue-loader 能工具实现编译器的工作")])]),t._v(" "),a("p",[t._v("因此使用 runtime 版本更加合理！！！")]),t._v(" "),a("blockquote",[a("p",[t._v("具体 vue 是如何不同的处理的，请看《生命周期》篇")])])])}),[],!1,null,null,null);s.default=e.exports}}]);